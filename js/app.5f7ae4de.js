(function(t){function e(e){for(var r,o,a=e[0],c=e[1],l=e[2],u=0,h=[];u<a.length;u++)o=a[u],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&h.push(s[o][0]),s[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);d&&d(e);while(h.length)h.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],r=!0,a=1;a<n.length;a++){var c=n[a];0!==s[c]&&(r=!1)}r&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var r={},s={app:0},i=[];function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/gizmo-ball-vue/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var l=0;l<a.length;l++)e(a[l]);var d=c;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"07cb":function(t,e,n){"use strict";n("d494")},"0f3e":function(t,e,n){"use strict";n("219a")},1946:function(t,e,n){"use strict";n("45e1")},"219a":function(t,e,n){},"25e2":function(t,e,n){},"28c1":function(t,e,n){"use strict";n("2c08")},"2c08":function(t,e,n){},"2e54":function(t,e,n){"use strict";n("25e2")},4191:function(t,e,n){"use strict";n("70e9")},"45e1":function(t,e,n){},"6a12":function(t,e,n){"use strict";n("db4a")},"70e9":function(t,e,n){},"8e21":function(t,e,n){},cd49:function(t,e,n){"use strict";n.r(e);var r=n("2b0e"),s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{ref:"app",attrs:{id:"app"}},[e("Home")],1)},i=[],o=n("9ab4"),a=n("60a3"),c=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"home"},[e("div",{staticClass:"main test-border"},[e("GamePanel")],1),e("div",{staticClass:"right-side test-border"},[e("div",{staticClass:"right-top test-border"},[e("ItemZone")],1),e("div",{staticClass:"right-middle test-border"},[e("ToolZone")],1),e("div",{staticClass:"right-bottom test-border"},[e("ModeZone")],1)]),e("div",{staticClass:"instruction"},[e("Instruction")],1)])},l=[],d=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"game-panel"},[e("div",{ref:"game-grid",staticClass:"game-grid",staticStyle:{"background-image":"url(img/grid.png)"},on:{click:function(e){return t.onPanelClick()},drop:t.onDrop,dragover:function(e){return e.preventDefault(),t.onDragover.apply(null,arguments)},dragenter:function(t){t.preventDefault()}}},t._l(t.items,(function(n,r){return e("ItemImage",{key:r,attrs:{item:n,selected:t.currentItemId===n.id},nativeOn:{click:function(e){return e.stopPropagation(),t.onImgClick(n)}}})})),1)])},u=[],h=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("img",{ref:"img",class:t.cssClass,style:`position: absolute;top:${t.item.position.y}px;left:${t.item.position.x}px;z-index:${t.zindex};transform: rotate(${t.rotation}deg)`,attrs:{src:t.item.imgURL,width:t.width+"px",height:t.height+"px",draggable:t.imageDraggable},on:{dragstart:function(e){return t.onDragstart(e)},dragend:function(e){return t.onDragend()}}})},m=[];n("d9e2");class p{constructor(t,e){this.x=t,this.y=e}equals(t){return p.equals(this,t)}clone(){return p.copy(this)}add(t){return this.x+=t.x,this.y+=t.y,this}as(t){return this.x=t.x,this.y=t.y,this}mult(t){return this.x*=t,this.y*=t,this}dot(t){return p.dot(this,t)}get radius(){return p.radius(this)}get normalVector(){return p.normalVector(this)}get unitVector(){return p.unitization(this)}projection(t){return p.projection(this,t)}component(t){return p.vectorProjection(this,t)}vectorRotate(t){return this.as(p.vectorRotate(this,t))}pointRotate(t,e){return this.as(p.pointRotate(this,t,e))}directionRotate(t){return this.as(t.clone().mult(this.radius/t.radius))}reflet(t){return this.as(p.reflect(this,t))}static add(t,e){return new p(t.x+e.x,t.y+e.y)}static difference(t,e){return new p(t.x-e.x,t.y-e.y)}static negate(t){return new p(-t.x,-t.y)}static mult(t,e){return new p(t.x*e,t.y*e)}static dot(t,e){return t.x*e.x+t.y*e.y}static radius(t){return Math.sqrt(p.dot(t,t))}static unitization(t){if(t.equals(p.ZERO))throw new Error("cannot get unitization of zero vector");return t.clone().mult(1/t.radius)}static projection(t,e){return p.dot(t,e)/e.radius}static vectorProjection(t,e){return e.clone().mult(t.dot(e)/e.dot(e))}static angle(t,e){return Math.acos(p.dot(t,e)/(t.radius*e.radius))}static copy(t){return new p(t.x,t.y)}static get ZERO(){return new p(0,0)}static equals(t,e){return t.x===e.x&&t.y===e.y}static normalVector(t){return new p(t.y,-t.x)}static vectorRotate(t,e){const n=e.value,r=Math.cos(n),s=Math.sin(n);switch(e.special){case"right-angle":return new p(-t.y,t.x);case"right-angle-reverse":return new p(t.y,-t.x);case"":return new p(t.x*r-t.y*s,t.y*r+t.x*s)}}static pointRotate(t,e,n){return p.difference(t,e).vectorRotate(n).add(e)}static reflect(t,e){return t.component(e).mult(-2).add(t)}static sum(t){const e=p.ZERO;return t.forEach(t=>{e.add(t)}),e}static average(t){return t.length?p.sum(t).mult(1/t.length):p.ZERO}static center(t){return p.sum(t).mult(1/t.length)}}var g;n("14d9");(function(t){t[t["Up"]=0]="Up",t[t["Right"]=1]="Right",t[t["Down"]=2]="Down",t[t["Left"]=3]="Left"})(g||(g={}));class f{constructor(t,e){if(this.p1=t,this.p2=e,t.equals(e))throw new Error("Points cannot be the same!")}get directionVector(){return p.difference(this.p1,this.p2)}get normalVector(){return this.directionVector.normalVector}distance(t){const e=p.difference(t,this.p1),n=this.normalVector;return Math.abs(e.projection(n))}clone(){return new f(this.p1.clone(),this.p2.clone())}}class v{constructor(t,e){this.special=t,this.value=e}}v.RIGHT_ANGLE=new v("right-angle",Math.PI/2),v.RIGHT_ANGLE_REVERSE=new v("right-angle-reverse",0-Math.PI/2);class b{static get gravity(){return new p(0,15)}static surfaceVelocityReflect(t,e){const n=t.v;n.dot(e)<0&&(t.move(-b.tick),t.setVelocity(t.v.reflet(e)))}static perfectElasticCollision(t,e){const n=t.v,r=e.v,s=p.difference(e.p,t.p),i=s.normalVector;if(s.dot(n)>0){const o=r.component(s).add(n.component(i)),a=n.component(s).add(r.component(i));t.setVelocity(o),e.setVelocity(a)}}static centripetalAcceleration(t,e,n){const r=t.v,s=r.dot(r)/e;return p.difference(n,t.p).unitVector.mult(s)}}b.tick=.025,b.pipeAcc=p.negate(b.gravity);class y{constructor(){this._a=new p(0,0),this._v=new p(0,0),this._p=new p(0,0),this._accRecord=new Map([["gravity",b.gravity],["centripetal",new p(0,0)],["pipe",new p(0,0)]])}get p(){return p.copy(this._p)}get v(){return p.copy(this._v)}get a(){return p.copy(this._a)}tick(){this.changeVelocity(),this.move()}translate(t){return this._p=t.clone(),this}move(t=b.tick){return this._p.add(p.mult(this._v,t)),this}changeVelocity(t=b.tick){return this._v.add(p.mult(this._a,t)),this._v.radius>=200&&this._v.mult(200/this._v.radius),this}setVelocity(t){return this._v.as(t),this}addVelocity(t){return this._v.add(t),this}setAcceleration(t,e){this._accRecord.set(t,e);const n=p.sum(this._accRecord);return this._a=n,this}}class I{constructor(){this._rotation=g.Up,this._zoom=1}get position(){return this._position.clone()}set position(t){this.translate(t)}get rotation(){return this._rotation}set rotation(t){const e=(this._rotation-t+4)%4;for(let n=0;n<e;n++)this.rotate(this.center,v.RIGHT_ANGLE_REVERSE);this._rotation=t}get zoom(){return this._zoom}set zoom(t){if(t<=0)throw new Error("Zoom value must be positive");this.zoomTo(this.position,t)}}class _ extends I{constructor(t,e=p.ZERO){super(),this._vertexes=t,this._position=e,this._edges=this._vertexes.map((t,e,n)=>new f(t,n[(e+1)%n.length]))}get edges(){return this._edges.map(t=>t.clone())}get vertexes(){return this._vertexes.map(t=>t.clone())}get center(){return p.average(this._vertexes)}zoomTo(t,e){return e!==this._zoom&&this._vertexes.forEach(n=>n.as(p.add(t,p.difference(n,t).mult(e/this._zoom)))),this._zoom=e,this}rotate(t,e){switch(this._vertexes.forEach(n=>n.pointRotate(t,e)),e.special){case"right-angle-reverse":this._rotation=(this._rotation-1+4)%4;break;case"right-angle":this._rotation=(this._rotation+1)%4;break;case"":break}return this}translate(t){return this._vertexes.forEach(e=>e.add(p.difference(t,this._position))),this._position=t.clone(),this}crashDetect(t){if(t instanceof _){const e=t.edges,n=[];for(const t of e)n.push(t.normalVector);if(0===n.length)return _.polygonCollidesWithCircle(this,t);for(const t of this.edges)n.push(t.normalVector);return!this.separationOnAxes(n,t)}return!1}static polygonCollidesWithCircle(t,e){if(t instanceof _&&e instanceof w){const n=_.getPolygonPointClosestToCircle(t,e),r=t.edges,s=[];if(void 0!==n){for(const t of r)s.push(t.normalVector);return s.push(p.difference(n,e.center)),!t.separationOnAxes(s,e)}}return!1}separationOnAxes(t,e){for(const n of t){const t=this.project(n),r=e.project(n);if(!(t.y>r.x&&r.y>t.x))return!0}return!1}project(t){const e=[],n=new p(0,0);return this.vertexes.forEach(r=>{n.x=r.x,n.y=r.y,e.push(n.projection(t))}),new p(Math.min.apply(Math,e),Math.max.apply(Math,e))}static getPolygonPointClosestToCircle(t,e){let n=1e5;const r=t.vertexes;let s=r[0];for(const i of r){const t=p.difference(e.center,i).radius;n>t&&(n=t,s=i)}return s}static outPointProjectionOnEdge(t,e){const n=p.difference(e,t.p1),r=p.difference(e,t.p2),s=t.normalVector;if(n.dot(s)<=0||r.dot(s)<=0)return!1;{const e=p.difference(t.p2,t.p1),s=p.negate(e);return e.dot(n)>=0&&s.dot(r)>=0}}crashHandle(t){if(t instanceof O){let e=null;const n=t.massPoint.p.add(t.massPoint.v.mult(-b.tick));for(const t of this._edges)if(null===e&&_.outPointProjectionOnEdge(t,n)){e=t;break}if(null!==e){const n=e.normalVector;b.surfaceVelocityReflect(t.massPoint,n)}else{const e=_.getPolygonPointClosestToCircle(this,t);b.surfaceVelocityReflect(t.massPoint,p.difference(t.center,e))}}}}class w extends _{constructor(t,e){super([],t.clone()),this._radius=e}get radius(){return this.zoom*this._radius}get center(){return this.position.add(new p(this.radius,this.radius))}project(t){const e=[],n=this.center,r=n.projection(t);return e.push(r),e.push(r-this.radius),e.push(r+this.radius),new p(Math.min.apply(Math,e),Math.max.apply(Math,e))}crashDetect(t){if(t instanceof _){const e=t.edges,n=[];for(const t of e)n.push(t.normalVector);if(0===n.length&&t instanceof w){const e=p.difference(this.center,t.center).radius;return e<Math.abs(this.radius+t.radius)}return _.polygonCollidesWithCircle(t,this)}return!1}crashHandle(t){if(t instanceof O){const e=p.difference(t.center,this.center);b.surfaceVelocityReflect(t.massPoint,e)}}}class x{constructor(t){this.collider=t,this.id=++x.currentID,console.log(`MapItem ${this.id} init`)}get center(){return this.collider.center}translate(t){return this.collider.translate(t),this}crashDetect(t){return t instanceof x?this.collider.crashDetect(t.collider):this.collider.crashDetect(t)}crashHandle(t){return this.collider.crashHandle(t)}get position(){return this.collider.position}set position(t){this.collider.position=t}}x.gridScale=36,x.vertical=new p(0,x.gridScale),x.horizontal=new p(x.gridScale,0),x.currentID=0;class O extends x{constructor(t,e){super(new w(new p(t,e),x.gridScale/2)),this.pipeID=-1,this.massPoint=new y,this.massPoint.translate(this.center)}get name(){return O.Name}get center(){return this.collider.center}crashHandle(t){t instanceof O?b.perfectElasticCollision(this.massPoint,t.massPoint):super.crashHandle(t)}translate(t){return super.translate(t),this.massPoint.translate(this.center),this}get imgURL(){return O.imageUrl}}O.Name="ball",O.imageUrl="img/item/ball.png";var M=n("2f62"),P=n("1898");function C(t){return void 0!==t.typeValue}const z=35,A=1,V={typeValue:"select",img:"img/item/select.png"},S={typeValue:"select",img:"img/item/select.png"},k={typeValue:"ball",img:"img/item/ball.png"},R={typeValue:"absorber",img:"img/item/absorber.png"},L={typeValue:"triangle",img:"img/item/triangle.png"},T={typeValue:"circle",img:"img/item/circle.png"},D={typeValue:"square",img:"img/item/square.png"},j={typeValue:"pipe",img:"img/item/pipe_normal.png"},N={typeValue:"pipe-turned",img:"img/item/pipe_turned.png"},E={typeValue:"baffle-alpha",img:"img/item/baffle-mid.png"},U={typeValue:"baffle-beta",img:"img/item/baffle-mid.png"},Z={absorber:R,"baffle-alpha":E,"baffle-beta":U,ball:k,circle:T,pipe:j,"pipe-turned":N,select:S,square:D,triangle:L,border:S};const Y={gridLength:z,gridLineLength:A,sampleItem:V,selectItem:S,ballItem:k,absorberItem:R,triangleItem:L,circleItem:T,squareItem:D,pipeItem:j,pipeTurnedItem:N,baffleAlphaItem:E,baffleBetaItem:U,sampleItems:[V,k],itemss:[[S,k],[R,L],[T,D],[j,N],[E,U]],itemMap:{absorber:R,"baffle-alpha":E,"baffle-beta":U,ball:k,circle:T,pipe:j,"pipe-turned":N,select:S,square:D,triangle:L,border:S},getViewItemByType(t){return Z[t]}};var J={state:{useLightTheme:!0,currentMode:"LAYOUT",currentState:"PAUSE",draggingItem:null,draggingItemOffset:new p(0,0),toolZoneCurrentItem:Y.selectItem,panelCurrentItem:null},mutations:{changeTheme(t,e){var n;t.useLightTheme=e;const r=e?"light":"dark";null===(n=document.getElementById("app-skin"))||void 0===n||n.setAttribute("href",`skin/${r}/skin.css`)},changeMode(t,e){t.currentMode=e},changeState(t,e){t.currentState=e},changeDraggingItem(t,e){t.draggingItem=e},changeDraggingItemOffset(t,e){t.draggingItemOffset=e},changeToolZoneCurrentItem(t,e){t.toolZoneCurrentItem=e,"select"!==e.typeValue&&t.panelCurrentItem},changePanelCurrentItem(t,e){t.panelCurrentItem=e}},actions:{},modules:{}};r["a"].use(M["a"]);const{store:H,rootActionContext:G,moduleActionContext:B}=Object(P["a"])({modules:{module1:J}});var q=H;function W(t){return void 0!==t.rotate}function $(t){return void 0!==t.zoomTo}let F=class extends a["c"]{constructor(){super(...arguments),this.defaultSize=Y.gridLength+Y.gridLineLength}get cssClass(){return this.selected?"pick-box":""}get rotation(){return W(this.item)?90*this.item.rotation:0}get zindex(){return this.item instanceof O?100:1}get width(){let t=this.defaultSize;"baffle-alpha"!==this.item.name&&"baffle-beta"!==this.item.name||(t=2*t-1);let e=t-1;return $(this.item)&&(e=this.item.zoom*t-1),e}get height(){let t=this.defaultSize-1;return $(this.item)&&(t=this.item.zoom*this.defaultSize-1),t}get imageDraggable(){const t=q.state.module1;return"LAYOUT"==t.currentMode&&"select"==t.toolZoneCurrentItem.typeValue}onDragstart(t){q.commit.changeDraggingItemOffset(new p(t.offsetX,t.offsetY)),q.commit.changeDraggingItem(this.item)}onDragend(){q.commit.changeDraggingItem(null)}};Object(o["a"])([Object(a["b"])()],F.prototype,"item",void 0),Object(o["a"])([Object(a["b"])()],F.prototype,"selected",void 0),F=Object(o["a"])([a["a"]],F);var X=F,K=X,Q=(n("2e54"),n("2877")),tt=Object(Q["a"])(K,h,m,!1,null,"92cbf116",null),et=tt.exports;class nt extends x{constructor(t){super(t),this.collider=t}get zoom(){return this.collider.zoom}zoomTo(t,e){return this.collider.zoomTo(t,e),this}get rotation(){return this.collider.rotation}set rotation(t){this.collider.rotation=t}rotate(t,e){return this.collider.rotate(t,e),this}get center(){return this.collider.center}}class rt extends _{get center(){return this.position.add(x.vertical.clone().add(x.horizontal).mult(.5*this.zoom))}constructor(t){super([t.clone(),t.clone().add(x.vertical),t.clone().add(x.horizontal).add(x.vertical),t.clone().add(x.horizontal)],t)}}class st extends nt{constructor(t,e){super(new rt(new p(t,e)))}get name(){return st.Name}get imgURL(){return st.imageUrl}}st.Name="square",st.imageUrl="img/item/square.png";class it extends nt{constructor(t,e){super(new rt(new p(t,e)))}get name(){return it.Name}get imgURL(){return it.imageURL}crashHandle(t){t instanceof O&&wt.getInstance().handleAbsorb(t.id)}}it.imageURL="img/item/absorber.png",it.Name="absorber";class ot extends _{constructor(t){const e=x.vertical.clone().mult(.25),n=x.horizontal.clone().mult(2);super([t.clone(),t.clone().add(e),t.clone().add(n).add(e),t.clone().add(n)],t)}}class at extends x{constructor(t,e){super(new ot(new p(t,e)))}get imgURL(){return at.imageURL}move(t){return this.translate(this.position.add(t)),this}}at.imageURL="img/item/baffle.png";class ct extends at{get name(){return ct.Name}}ct.Name="baffle-alpha";class lt extends at{get name(){return lt.Name}}lt.Name="baffle-beta";class dt extends I{constructor(){super(),this.borders=[],this._position=p.ZERO;const t=x.vertical.clone(),e=x.horizontal.clone(),n=p.mult(t,wt.maxGridCount),r=p.mult(e,wt.maxGridCount);this.borders.push(new _([p.negate(e),p.difference(n,e),p.copy(n),p.ZERO])),this.borders.push(new _([p.copy(n),p.add(n,t),p.add(n,t).add(r),p.add(r,n)])),this.borders.push(new _([p.copy(r),p.add(n,r),p.add(n,r).add(e),p.add(e,r)])),this.borders.push(new _([p.negate(t),p.ZERO,p.copy(r),p.difference(r,t)]))}crashDetect(t){for(const e of this.borders)if(e.crashDetect(t)||t.crashDetect(e))return!0;return!1}crashHandle(t){if(t instanceof O)for(const e of this.borders)t.crashDetect(e)&&e.crashHandle(t)}get center(){throw new Error("Method not implemented.")}translate(t){throw new Error("Method not implemented.")}rotate(t,e){throw new Error("Method not implemented.")}zoomTo(t,e){throw new Error("Method not implemented.")}}class ut extends x{get name(){return"border"}get imgURL(){return""}constructor(){super(new dt)}}class ht extends nt{constructor(t,e){super(new w(new p(t,e),x.gridScale/2))}get name(){return ht.Name}get imgURL(){return ht.imageURL}}ht.imageURL="img/item/circle.png",ht.Name="circle";class mt extends _{get center(){return this.position.add(x.vertical.clone().add(x.horizontal).mult(.5*this.zoom))}constructor(t){super([t.clone(),t.clone().add(x.vertical),t.clone().add(x.horizontal).add(x.vertical),t.clone().add(x.horizontal)],t)}crashHandle(t){super.crashHandle(t)}}class pt extends x{constructor(t,e){super(new mt(new p(t,e)))}get rotation(){return this.collider.rotation}set rotation(t){this.collider.rotation=t}rotate(t,e){return this.collider.rotate(t,e),this}get name(){return pt.Name}get imgURL(){return pt.imageUrl}crashHandle(t){if(t instanceof O){const e=t.massPoint,n=e.v;let r=null;const s=t.massPoint.p.add(e.v.mult(-b.tick)),i=this.collider.edges;for(const t of i){const e=p.difference(s,t.p1),n=p.difference(s,t.p2);if(null===r){const s=t.normalVector;if(e.dot(s)>=0&&n.dot(s)>=0){r=t;break}}}if(null!==r)if(r.p1.equals(i[0].p1)||r.p1.equals(i[2].p1))this.collider.crashHandle(t);else{const s=r.normalVector;if(n.dot(s)<0){const i=p.center([r.p1,r.p2]),o=t.center;if(Math.abs(p.difference(o,i).projection(r.directionVector))<10){-1!==t.pipeID?e.setVelocity(n.component(s).mult(n.radius/Math.abs(n.projection(s)))):e.setVelocity(n.component(s)),t.pipeID=this.id;const a=p.difference(i,o).component(r.directionVector);t.translate(t.position.add(a))}else this.collider.crashHandle(t)}else t.pipeID===this.id&&(t.pipeID=-1,e.setAcceleration("pipe",p.ZERO),e.setAcceleration("centripetal",p.ZERO))}else e.setAcceleration("pipe",b.pipeAcc),e.setAcceleration("centripetal",p.ZERO)}}}pt.Name="pipe",pt.imageUrl="img/item/pipe_normal.png";class gt extends _{get center(){return this.position.add(x.vertical.clone().add(x.horizontal).mult(.5*this.zoom))}get centre(){return this._vertexes[2].clone()}get entryAxis1(){return this._edges[1].normalVector}get entryAxis2(){return this._edges[2].normalVector}constructor(t){super([t.clone(),t.clone().add(x.vertical),t.clone().add(x.horizontal).add(x.vertical),t.clone().add(x.horizontal)],t)}}class ft extends x{constructor(t,e){super(new gt(new p(t,e)))}get rotation(){return this.collider.rotation}set rotation(t){this.collider.rotation=t}rotate(t,e){return this.collider.rotate(t,e),this}get name(){return ft.Name}get imgURL(){return ft.imageUrl}crashHandle(t){if(t instanceof O){const e=t.massPoint,n=e.v;let r=null;const s=t.massPoint.p.add(e.v.mult(-b.tick)),i=this.collider.edges;for(const t of i){const e=p.difference(s,t.p1),n=p.difference(s,t.p2);if(null===r){const s=t.normalVector;if(e.dot(s)>=0&&n.dot(s)>=0){r=t;break}}}if(null!==r)if(r.p1.equals(i[0].p1)||r.p1.equals(i[3].p1))this.collider.crashHandle(t);else{const s=r.normalVector;if(n.dot(s)<0){const i=p.center([r.p1,r.p2]),o=t.center;if(Math.abs(p.difference(o,i).projection(r.directionVector))<10){t.pipeID=this.id,e.setVelocity(n.component(s)),e.setAcceleration("pipe",b.pipeAcc);const a=p.difference(i,o).component(r.directionVector);t.translate(t.position.add(a))}else this.collider.crashHandle(t)}else t.pipeID===this.id&&(t.pipeID=-1,e.setAcceleration("pipe",p.ZERO),e.setAcceleration("centripetal",p.ZERO))}else p.difference(t.center,this.center).radius<5&&(this.collider.entryAxis1.dot(n)<0?(t.translate(this.position),e.setVelocity(n.clone().directionRotate(this.collider.entryAxis2))):this.collider.entryAxis2.dot(n)<0&&(t.translate(this.position),e.setVelocity(n.clone().directionRotate(this.collider.entryAxis1))))}}}ft.Name="pipe-turned",ft.imageUrl="img/item/pipe_turned.png";class vt extends _{get center(){return this.position.add(x.vertical.clone().add(x.horizontal).mult(.5*this.zoom))}constructor(t){super([t.clone(),t.clone().add(x.vertical),t.clone().add(x.horizontal).add(x.vertical)],t)}}class bt extends nt{constructor(t,e){super(new vt(new p(t,e)))}get name(){return bt.Name}get center(){return this.collider.center}get imgURL(){return bt.imageUrl}}bt.Name="triangle",bt.imageUrl="img/item/triangle.png";const yt={absorber:it,"baffle-alpha":ct,"baffle-beta":lt,ball:O,border:ut,circle:ht,pipe:pt,"pipe-turned":ft,square:st,triangle:bt};class It{static createFromJSON(t){return t.name&&t.position&&void 0!==t.position.x&&void 0!==t.position.y?{name:t.name,position:new p(t.position.x,t.position.y),zoom:t.zoom,rotation:t.rotation}:null}}class _t{constructor(){this.state="LAYOUT",this.mapItems=new Map,this.balls=new Map,this.border=new ut,this.mapItems.set(this.border.id,this.border),this.alphaBaffles=new Map,this.betaBaffles=new Map,this.savedJSONString=this.mapItemsToJSON(this.mapItems)}static getInstance(){var t;return null!==(t=this.controller)&&void 0!==t?t:this.controller=new _t}get items(){const t=[];for(const[,e]of this.mapItems)e instanceof ut||t.push(e);return t}createMapItem(t,e,n){const r=new yt[t](e,n);return this.handleAddItem(r)?(this.savedJSONString=this.mapItemsToJSON(this.mapItems),r):null}loadMapItemsFromItems(t){this.clearAll();for(const e of t)e instanceof O?this.balls.set(e.id,e):e instanceof ct?this.alphaBaffles.set(e.id,e):e instanceof lt&&this.betaBaffles.set(e.id,e),this.mapItems.set(e.id,e)}loadMapItemsFromJSON(t){const e=this.readFromJSON(t);if(null==e)throw new Error("内部读取错误");this.loadMapItemsFromItems(e)}readFromJSON(t){const e=JSON.parse(t),n=[];if(e instanceof Array)for(const r of e){const t=It.createFromJSON(r);if(null===t)return null;{const e=new yt[t.name](t.position.x,t.position.y);if(W(e)){if(void 0===t.rotation)return null;e.rotation=t.rotation}if($(e)){if(void 0===t.zoom)return null;e.zoomTo(e.position,t.zoom)}n.push(e)}}for(const r of n)for(const t of n)if(r.id!==t.id&&r.crashDetect(t))return null;return n}collidesWithOthers(t){for(const e of this.mapItems)if(e[0]!==t.id&&e[1].crashDetect(t))return!0;return!1}handleAddItem(t){for(const e of this.mapItems)if(e[1].crashDetect(t))return!1;return this.mapItems.set(t.id,t),t instanceof O?this.balls.set(t.id,t):t instanceof ct?this.alphaBaffles.set(t.id,t):t instanceof lt&&this.betaBaffles.set(t.id,t),!0}handleDraggingItem(t,e){const n=this.mapItems.get(t);if(void 0!==n){const t=n.position;return n.translate(e),this.collidesWithOthers(n)?(n.translate(t),!1):(this.savedJSONString=this.mapItemsToJSON(this.mapItems),!0)}return!1}handleDeleteItem(t){this.balls.delete(t),this.alphaBaffles.delete(t),this.betaBaffles.delete(t);const e=this.mapItems.delete(t);return this.savedJSONString=this.mapItemsToJSON(this.mapItems),e}handleAbsorb(t){const e=this.mapItems.get(t);return void 0!==e&&e instanceof O&&(this.balls.delete(t),this.mapItems.delete(t),!0)}handleZoomIn(t){const e=this.mapItems.get(t);if(void 0!==e&&$(e)){const t=e.zoom;return e.zoomTo(e.position,t+1),this.collidesWithOthers(e)?(e.zoomTo(e.position,t),!1):(this.savedJSONString=this.mapItemsToJSON(this.mapItems),!0)}return!1}handleZoomOut(t){const e=this.mapItems.get(t);if(void 0!==e&&$(e)){const t=e.zoom;return!(t<=1)&&(e.zoomTo(e.position,t-1),this.collidesWithOthers(e)?(e.zoomTo(e.position,t),!1):(this.savedJSONString=this.mapItemsToJSON(this.mapItems),!0))}return!1}handleRotate(t){const e=this.mapItems.get(t);return!(void 0===e||!W(e))&&(e.rotate(e.center,v.RIGHT_ANGLE),this.collidesWithOthers(e)?(e.rotate(e.center,v.RIGHT_ANGLE_REVERSE),!1):(this.savedJSONString=this.mapItemsToJSON(this.mapItems),!0))}startPlaying(){this.state="PLAYING";for(const e of this.balls){const t=e[1];t.massPoint.setAcceleration("gravity",b.gravity),t.massPoint.setAcceleration("pipe",new p(0,0)),t.massPoint.setAcceleration("centripetal",new p(0,0))}const t=setInterval(()=>{switch(this.state){case"PLAYING":for(const[,t]of this.balls){t.massPoint.tick(),t.translate(p.difference(t.position,t.center).add(t.massPoint.p));for(const[,e]of this.mapItems)e.id!=t.id&&e.crashDetect(t)&&e.crashHandle(t)}break;case"PAUSED":break;case"LAYOUT":clearInterval(t);break;default:break}},1)}stopPlaying(){this.state="LAYOUT",this.mapItems.clear(),this.mapItems.set(this.border.id,this.border),this.loadMapItemsFromJSON(this.savedJSONString)}pause(){this.state="PAUSED"}continue(){this.state="PLAYING"}mapItemsToJSON(t){const e=[];for(const[,n]of t){const t=n,r={name:t.name,position:t.position,rotation:W(t)?t.rotation:void 0,zoom:$(t)?t.zoom:void 0};e.push(r)}return JSON.stringify(e)}clearAll(){this.balls.clear(),this.alphaBaffles.clear(),this.betaBaffles.clear(),this.mapItems.clear()}handleBaffleMove(t,e){const n=p.ZERO;switch(e){case"left":n.x=-5;break;case"right":n.x=5;break;default:break}switch(t){case"baffle-alpha":for(const[,t]of this.alphaBaffles)t.move(n),this.collidesWithOthers(t)&&t.move(p.negate(n));break;case"baffle-beta":for(const[,t]of this.betaBaffles)t.move(n),this.collidesWithOthers(t)&&t.move(p.negate(n));break;default:break}}}_t.maxGridCount=20,_t.maxXY=_t.maxGridCount*x.gridScale;var wt=_t;let xt=class extends a["c"]{constructor(){super(...arguments),this.items=[]}get currentItemId(){return"LAYOUT"===q.state.module1.currentMode&&q.state.module1.panelCurrentItem?q.state.module1.panelCurrentItem.id:0}mounted(){const t=this.$refs["game-grid"].getBoundingClientRect();this.gridX=t.left,this.gridY=t.top,setInterval(()=>{this.items=wt.getInstance().items},100)}onPanelClick(){q.commit.changePanelCurrentItem(null)}onImgClick(t){const e=q.state.module1;"select"===e.toolZoneCurrentItem.typeValue&&"LAYOUT"===e.currentMode&&q.commit.changePanelCurrentItem(t)}onDragover(t){const e=q.state.module1.draggingItem;t.dataTransfer&&(null===e?t.dataTransfer.dropEffect="none":C(e)?t.dataTransfer.dropEffect="copy":e instanceof x&&(t.dataTransfer.dropEffect="move"))}onDrop(t){const e=q.state.module1.draggingItem;if(null===e)return;const n=q.state.module1.draggingItemOffset,r=new p(t.clientX-this.gridX-n.x,t.clientY-this.gridY-n.y);if(C(e)&&"select"!==e.typeValue){this.formatPosition(r,"floor");const t=wt.getInstance().createMapItem(e.typeValue,r.x,r.y);null!=t&&q.commit.changePanelCurrentItem(t)}else e instanceof x&&(this.formatPosition(r,"round"),wt.getInstance().handleDraggingItem(e.id,r))}formatPosition(t,e){const n=Y.gridLength+Y.gridLineLength;"round"==e?(t.x=Math.round(t.x/n)*n,t.y=Math.round(t.y/n)*n):(t.x=Math.floor(t.x/n)*n,t.y=Math.floor(t.y/n)*n)}};xt=Object(o["a"])([Object(a["a"])({components:{ItemImage:et}})],xt);var Ot=xt,Mt=Ot,Pt=(n("07cb"),Object(Q["a"])(Mt,d,u,!1,null,"849369b8",null)),Ct=Pt.exports,zt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"item-zone",style:"pointer-events: "+("LAYOUT"==t.currentMode?"auto":"none")},[e("table",{staticClass:"item-table",attrs:{width:"100%"}},[e("caption",{staticClass:"caption"},[t._v(" 组件栏 ")]),t._l(t.itemss,(function(n,r){return e("tr",{key:r,staticClass:"two-item"},t._l(n,(function(n,s){return e("td",{key:s},[e("label",{staticClass:"item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.currentItem,expression:"currentItem"}],attrs:{id:"items"+(4*r+s),type:"radio",name:"chooseItem"},domProps:{checked:n.typeValue,value:n.typeValue,checked:t._q(t.currentItem,n.typeValue)},on:{change:function(e){t.currentItem=n.typeValue}}}),e("img",{attrs:{src:n.img,draggable:"select"!=n.typeValue,height:t.length,width:t.length},on:{dragstart:function(e){return t.onDragstart(n,e)},dragend:function(e){return t.onDragend(n,e)}}})])])})),0)}))],2)])},At=[];let Vt=class extends a["c"]{constructor(){super(...arguments),this.length=48,this.currentItem="select",this.itemss=Y.itemss}get currentMode(){return q.state.module1.currentMode}onCurrentItemChanged(t,e){q.commit.changeToolZoneCurrentItem(Y.getViewItemByType(t))}onDragstart(t,e){q.commit.changeDraggingItemOffset(new p(0,0)),q.commit.changeDraggingItem(t)}onDragend(t,e){q.commit.changeDraggingItem(null)}};Object(o["a"])([Object(a["d"])("currentItem")],Vt.prototype,"onCurrentItemChanged",null),Vt=Object(o["a"])([a["a"]],Vt);var St=Vt,kt=St,Rt=(n("6a12"),Object(Q["a"])(kt,zt,At,!1,null,"3e798ab6",null)),Lt=Rt.exports,Tt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"tool-zone",style:"pointer-events: "+(t.available?"auto":"none")},[e("table",{staticClass:"tool-table",attrs:{width:"100%"}},[e("caption",{staticClass:"caption"},[t._v(" 工具栏 ")]),e("tr",{staticClass:"two-tool"},[e("td",[e("img",{staticClass:"tool",attrs:{src:"img/tool/rotate.png",height:t.length,width:t.length},on:{click:t.rotate}})]),e("td",[e("img",{staticClass:"tool",attrs:{src:"img/tool/remove.png",height:t.length,width:t.length},on:{click:t.remove}})])]),e("tr",[e("td",[e("img",{staticClass:"tool",attrs:{src:"img/tool/zoom-in.png",height:t.length,width:t.length},on:{click:t.zoomin}})]),e("td",[e("img",{staticClass:"tool",attrs:{src:"img/tool/zoom-out.png",height:t.length,width:t.length},on:{click:t.zoomout}})])])])])},Dt=[];let jt=class extends a["c"]{constructor(){super(...arguments),this.length=50}get available(){const t=q.state.module1;return"LAYOUT"===t.currentMode&&null!=t.panelCurrentItem}get currentItem(){return q.state.module1.panelCurrentItem}rotate(){this.available&&this.currentItem&&wt.getInstance().handleRotate(this.currentItem.id)}remove(){this.available&&this.currentItem&&wt.getInstance().handleDeleteItem(this.currentItem.id)}zoomin(){this.available&&this.currentItem&&wt.getInstance().handleZoomIn(this.currentItem.id)}zoomout(){this.available&&this.currentItem&&wt.getInstance().handleZoomOut(this.currentItem.id)}};jt=Object(o["a"])([a["a"]],jt);var Nt=jt,Et=Nt,Ut=(n("ee14"),Object(Q["a"])(Et,Tt,Dt,!1,null,"08d92c8a",null)),Zt=Ut.exports,Yt=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"mode-zone"},[e("table",{staticClass:"mode-table",attrs:{width:"100%"}},[e("caption",{staticClass:"caption"},[t._v(" 模式栏 ")]),e("tr",[e("td",{staticClass:"mode-col",attrs:{align:"right"}},["LAYOUT"===t.currentMode?e("img",{attrs:{src:"img/mode/arrow.png",height:"20"}}):t._e()]),e("td",{attrs:{align:"left",colspan:"2"}},[e("button",{staticClass:"layout-button",on:{click:t.changeToLayoutMode}},[t._v(" 布局模式 ")])])]),e("tr",[e("td",{attrs:{align:"right"}},["PLAY"===t.currentMode?e("img",{attrs:{src:"img/mode/arrow.png",height:"20"}}):t._e()]),e("td",{attrs:{align:"left"}},[e("button",{staticClass:"play-button",on:{click:t.changeToPlayMode}},[t._v(" 游玩模式 ")])]),e("td",["PLAY"===t.currentMode?e("img",{staticClass:"controll-img",attrs:{src:t.controllImg,height:"30",title:"咋瓦鲁多"},on:{click:t.changeState}}):t._e()])])]),e("span",[t._v("GIZMO BALL")])])},Jt=[];let Ht=class extends a["c"]{get currentMode(){return q.state.module1.currentMode}get controllImg(){return"PLAYING"===q.state.module1.currentState?"img/mode/pause.png":"img/mode/continue.png"}changeState(){"PLAYING"===q.state.module1.currentState?(q.commit.changeState("PAUSE"),wt.getInstance().pause()):(q.commit.changeState("PLAYING"),wt.getInstance().continue())}changeToLayoutMode(){"LAYOUT"!==this.currentMode&&(q.commit.changeMode("LAYOUT"),q.commit.changeState("PAUSE"),wt.getInstance().stopPlaying())}changeToPlayMode(){"PLAY"!==this.currentMode&&(q.commit.changeMode("PLAY"),q.commit.changeState("PLAYING"),wt.getInstance().startPlaying())}};Ht=Object(o["a"])([a["a"]],Ht);var Gt=Ht,Bt=Gt,qt=(n("4191"),Object(Q["a"])(Bt,Yt,Jt,!1,null,"180a421e",null)),Wt=qt.exports,$t=function(){var t=this;t._self._c;return t._m(0)},Ft=[function(){var t=this,e=t._self._c;return e("div",[e("h1",{attrs:{id:"gizmo-ball"}},[t._v("Gizmo Ball")]),e("blockquote",[t._v(" 这是一个简单的弹球游戏。是electron桌面版砍掉了文件保存布局和加载布局的功能的阉割版。 ")]),e("h2",{attrs:{id:"操作说明"}},[t._v("操作说明")]),e("h3",{attrs:{id:"布局模式"}},[t._v("布局模式")]),e("ol",[e("li",[t._v(" 在选中“选择组件”（图标为手）的状态下，可以选择、拖动网格中的玩具布局。 ")]),e("li",[t._v(" 在选中网格中的一个组件实例时，可以通过工具栏调整选中的组件的旋转方向以及大小，也可以点X删除组件。 ")]),e("li",[t._v(" 选中其他组件没有什么意义……（本来是想做点击放置物品的，后来改成拖动就没用了） ")]),e("li",[t._v(" 最下面两个组件分别是左挡板和右挡板，区别是控制的按键不一样。他们不可以旋转或者改变大小。 ")]),e("li",[e("strong",[t._v("小球可以放多个，但是放太多可能会很卡（问就是优化的还不够）。")])])]),e("h3",{attrs:{id:"游玩模式"}},[t._v("游玩模式")]),e("ul",[e("li",[t._v("按键盘A/D可以左右移动左挡板，按键盘J/L移动右挡板。")]),e("li",[t._v("按蓝色的三角形发动"),e("code",[t._v("砸瓦鲁多")]),t._v("。")]),e("li",[t._v("剩下的也就只有看小球乱弹了……")])])])}],Xt=(n("1946"),{}),Kt=Object(Q["a"])(Xt,$t,Ft,!1,null,"4a5f8f2e",null),Qt=Kt.exports;let te=class extends a["c"]{};Object(o["a"])([Object(a["b"])()],te.prototype,"msg",void 0),te=Object(o["a"])([Object(a["a"])({components:{GamePanel:Ct,ItemZone:Lt,ToolZone:Zt,ModeZone:Wt,Instruction:Qt}})],te);var ee=te,ne=ee,re=(n("28c1"),Object(Q["a"])(ne,c,l,!1,null,"53f68fe2",null)),se=re.exports;class ie{static bindKey(){window.onkeydown=t=>{const e=t.key;this.keyMap.has(e)&&this.keyMap.set(e,!0)},window.onkeyup=t=>{const e=t.key;this.keyMap.has(e)&&this.keyMap.set(e,!1)};const t=wt.getInstance();setInterval(()=>{this.keyMap.get("a")&&t.handleBaffleMove("baffle-alpha","left"),this.keyMap.get("d")&&t.handleBaffleMove("baffle-alpha","right"),this.keyMap.get("l")&&t.handleBaffleMove("baffle-beta","right"),this.keyMap.get("j")&&t.handleBaffleMove("baffle-beta","left")},10)}}ie.keyMap=new Map([["a",!1],["d",!1],["j",!1],["l",!1]]);var oe=ie;let ae=class extends a["c"]{mounted(){oe.bindKey()}setAppSize(){this.$refs.app.style.height=window.innerHeight-30+"px",this.$refs.app.style.width=window.innerWidth+"px"}};ae=Object(o["a"])([Object(a["a"])({components:{Home:se}})],ae);var ce=ae,le=ce,de=(n("0f3e"),Object(Q["a"])(le,s,i,!1,null,null,null)),ue=de.exports;r["a"].config.productionTip=!1,new r["a"]({store:q,render:t=>t(ue)}).$mount("#app")},d494:function(t,e,n){},db4a:function(t,e,n){},ee14:function(t,e,n){"use strict";n("8e21")}});
//# sourceMappingURL=app.5f7ae4de.js.map